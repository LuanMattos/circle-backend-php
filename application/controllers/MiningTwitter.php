<?php
defined('BASEPATH') or exit('No direct script access allowed');

use Modules\Twitter\TwitterAPIExchange;

class MiningTwitter extends Home_Controller
{
    private $apiTwitter;
    private $urlSeguidores = 'https://api.twitter.com/1.1/followers/ids.json';

    public function __construct()
    {
        parent::__construct();
        $this->load->model('user_twitter/User_twitter_model');
        $this->load->model('user/User_model');
        $this->load->model('photos/Photos_model');
        $settings = array(
            'oauth_access_token' => "1352572081544826881-Su4jP8CJaQ4kIjFFjGOxmpAtuBh80v",
            'oauth_access_token_secret' => "CPTE8AWb6bTMJGpUra9qEqT2EoVCnWIxKtBpDFVjyaVBa",
            'consumer_key' => "3sgI4aeTMXkHYJW0Fb2sMkO3h",
            'consumer_secret' => "CiNBtwVyfN3lyks1hCBwq9wlk3pPZoXekiZZ7KZMxjHcOfsI0R"
        );
        $this->apiTwitter = new TwitterAPIExchange\TwitterAPIExchange($settings);
    }

    public function getListFollowersByUserId($userIdFrom = '4332035543')
    {
        $twitter = $this->apiTwitter;
        $getfield = "?user_id=$userIdFrom";
        $listFollowers = $twitter->setGetfield($getfield)
            ->buildOauth($this->urlSeguidores, 'GET')->performRequest();
    }

    public function getUserByScreenName($userName = '')
    {
        $twitter = $this->apiTwitter;
        $getfield = "?screen_name=$userName";
        $listFollowers = $twitter->setGetfield($getfield)
            ->buildOauth($this->urlSeguidores, 'GET')->performRequest();
    }

    public function saveUserById()
    {
        $hashtag = 'photography';
        $url = 'https://api.twitter.com/1.1/search/tweets.json';


        $spaces = strtolower(str_replace(' ','',$hashtag));
        $tags = explode(',',$spaces);
        foreach ($tags as $tag){
            $getfield = "?q=#{$tag}";
            $requestMethod = 'GET';
            $response = $this->apiTwitter->setGetfield($getfield)->buildOauth($url, $requestMethod)->performRequest();
            $list = json_decode($response);

//            if (count($list->statuses)) {
                foreach ($list->statuses as $line) {
                    $user_name = $line->user->screen_name;
                    $user_full_name = $line->user->name;
                    $address = $line->user->location;
                    $description = !empty($line->user->description) ? preg_replace('/[^A-Za-z0-9\-]/',' ',substr($line->user->description, 0, 99)) : '';
                    $user_cover_url = !empty($line->user->profile_banner_url) ? $line->user->profile_banner_url : NULL;
                    $user_avatar_url = !empty($line->user->profile_image_url) ? str_replace('_normal', '', $line->user->profile_image_url) : NULL;
                    $user_password = '$argon2i$v=19$m=65536,t=4,p=1$LjVHbzhBTzVLY0QzTDA2UQ$mHygzGkjxdpvP6wWSjRz8/idQ9bZ7V11xvpy+uE/VAk';
                    $user_email = $line->user->screen_name . "@mycircle.click";
                    $text = $line->text;

                    $data = [];
                    $data['user_name'] = addslashes($user_name);
                    $data['user_full_name'] = addslashes(substr(0, 39, $user_full_name));
                    $data['address'] = addslashes($address);
                    $data['description'] = $description;
                    $data['user_cover_url'] = $user_cover_url;
                    $data['user_avatar_url'] = $user_avatar_url;
                    $data['user_password'] = $user_password;
                    $data['user_email'] = $user_email;
                    $userExists = $this->User_model->getWhere(['user_name' => $data['user_name']], "row", $orderby = NULL, $direction = NULL, $limit = NULL, $offset = NULL, $validUser = false);
                    if (!empty($user_name) && !$userExists) {
                        $user = (object)$this->User_model->save($data,['user_id']);

                        if(isset($line->entities->media)){
                            foreach($line->entities->media as $media){
                                $validUrl = $this->Photos_model->getWhere(['photo_url' => $media->media_url_https], "row");
                                if(($media->type == 'photo' || $media->type == 'video') && !empty($media->media_url_https) && $user && ($user->user_id && !empty($user->user_id)) && !$validUrl) {
                                    $photo = [
                                        'user_id' => $user->user_id,
                                        'photo_post_date' => date('Y-m-d H:i:s'),
                                        'photo_url' => $media->media_url_https,
                                        'photo_allow_comments' => '1',
                                        'photo_public' => '1',
                                        'photo_likes' => 0,
                                        'photo_description'=>$text
                                    ];
                                    $this->Photos_model->save($photo);
                                }
                            }
                        }
                    }
                }
//            }
            set_time_limit(1000000000000000);
        }
        $secondsWait = 1;
        header("Refresh:$secondsWait");
        echo date('Y-m-d H:i:s');
        echo '<script type="text/javascript">location.reload(true);</script>';
    }

    public function setUserDatabase()
    {

//        $all = $this->User_twitter_model->getWhere(NULL, "array");
//        foreach ($all as $rowUsers) {
//            $explode = explode(',', $rowUsers['ids_followers']);
//        $ids = '830926163258253312,4492260281,852532467919720448,309490788,194651187,1885422625,2728353343,92615038,2731953789,381048040,2967899597,154723467,394946383,830567854516924418,2214357950,18375955,219000417,754019071,2158031615,2472055539,537731767,939044144,849302623614365696,2944508471,103274458,138538280,602104505,402447384,813377577498845185,834411117120208896,3302989089,115070867,4182443818,311565847,909174841,3572096655,255726622,826884847205568514,2308945735,841230580637392896,774117600317968384,840928909034151937,517994061,839565631372595210,2279508960,2480390828,1304159696,4848512771,3422824857,827168646803791873,813572852402229248,174040426,120534813,111762656,809916203477192706,868081777,86390297,821310839621844992,570420240,269879040,2471643103,160037300,374802423,2992938316,368096530,2840819500,143903739,742000235510173696,96032189,720703138039230465,821766364624986113,632165450,249519671,221479003,813565867,825556031166148608,147337822,713282300,198445528,173277561,86159715,181745713,62319454,278056493,975339692,2955646408,247900292,3442058177,889178322,140475546,132649561,107627535,720042035672010753,550686794,228748609,113026100,741885264872808448,89279889,170152008,897409572,59828300,808032139,290612097,104516469,198618151,126963192,812910599294357508,723156193854672896,217963392,1010304546,361244286,728290267527315456,1076763613,3287967557,2722585918,293092902,405296969,2870748693,422143078,802163557613891584,1316891174,700045988,1721252785,55556221,4213488819,3108663244,844495166,810800645787832320,1335225451,809960706917486592,3237537928,3254779030,4867114169,151531651,544558757,1547891143,139170593,739296189598838784,793909549963042816,199550287,302232285,109626725,85609007,2447592419,796060149563723776,67995347,122221545,795020658946228224,776858189178499099,366310392,791398329427062784,390484916,773583977932357632,791789903340269568,117466401,3017730435,138174411,2157608226,2370590856,310070196,354390890,779317113936896000,4905849831,740363740021952512,371361922,474286450,735813962021908480,99754800,61469314,113064343,2183579134,128055134,3337352626,781116193608437760,148181736,177422565,3342560135,2371275200,77794816,155339663,2547010561,4165383262,62148109,4724987362,72127738,120797553,1113831396,68499759,149300743,310966506,774999704811732992,298806639,763473967063658496,477250930,68214406,4869111567,143237375,557967635,402014239,545087578,359050202,70974542,483254044,718244215067668481,763879862939553793,1619999438,65258506,112186439,746486340724854784,767742471463985152,3391295050,735992449,114755409,87527276,53275722,137687625,761044504895815680,746752366775504896,260565165,531918033,1557956882,295909247,560700623,1714059404,4448819380,389594533,243388531,999691962,473017805,139084201,204965171,758752798276251648,3371283563,2173103275,2230650151,539260345,755939399150383104,328821136,737685932011335681,115258693,160241003,533714985,756617554953658369,212337988,1362921817,755184249171574784,48225510,2209821931,3177775155,751823055995998208,702126573,85612554,742530283837247488,149655127,73524585,365059165,116448336,722349512073850880,855364308,3307442025,742357030657220612,324606186,183054881,392734193,734902319830192128,739246646744223744,619235810,1399963142,738548191772184577,3303790378,165023075,46357733,286281113,4862173490,340462428,734437936394063872,4155481601,357775720,1180014577,860520937,718264240444960768,706470793769652225,91503870,55664729,122076726,1310904228,2353037183,726898666758348800,160040550,47369073,105954677,164390439,4854244425,138202637,51647752,719556995343380481,221561095,75374005,127383805,717822371269382144,707264347890966528,715325512894255105,233347317,301431537,278768702,713787854858686464,2768768594,3005084908,567292203,108177410,157739430,707179840651317248,3088697074,2296258610,2861260760,96255334,1683476845,578453714,400069274,700107543192797184,698622817743544321,4905669669,4902245757,62947698,131289624,73926994,3057254180,415623893,1148575680,284311337,4864893226,135897146,4701003856,277529975,61091578,273682358,267704479,391072948,913385852,213496257,112837245,2891565846,108683056,328290031,95086667,4729649906,73947108,155225787,267576369,100594122,90167721,251132075,198345335,134956105,212995299,127389265,2860917152,91118462,576049280,4517123843,79806893,4496518817,199058223,349774879,2454234186,87967403,127122971,73528075,115945969,62607606,218200346,4220262598,348026011,2352187302,98382711,2191564322,1337359074,2363207567,116901630,3442704567,4334397045,144391675,126166981,3241409395,984606210,183836967,86142702,3092461793,195871962,3856763189,2400410664,247353204,73328298,275873167,192077217,205368299,1018535502,311127038,257180586,76043242,4155881476,4144900709,4138518437,904797120,103357944,347871032,117096366,81971309,136343701,220869930,83566621,233989354,401412074,469049949,48848846,3426791992,2434822074,3922459095,134175821,3902796616,3880752268,339437937,2686468914,142892664,289689894,61730734,2354503127,3754995977,3751061596,3414066755,137092842,146957402,3357569769,868513243,3663662121,3425485241,3646833496,413681603,348651021,155704866,135890219,3526682301,3515585241,3504627921,3434940737,134945548,3416694465,185440058,301786004,190876060,292681388,2298618295,74820130,131997859,74049662,1292841210,263883366,3001637558,76520545,2537816092,3388844757,155570947,112592680,156115346,1358266969,2359657031,3380323870,3377740101,3292306797,2671818247,607478279,2445744869,45915271,3364984919,3333530085,3124419123,3362510363,3360772367,3359779833,90684042,93847393,425676766,366214132,287414747,491712395,3315008279,413544212,118218906,149628227,2209552411,103741950,54397043,1381262737,497313554,195914599,119100299,2764423595,131988635,1353115272,3298388339,2934657873,3247223732,376390223,414850640,3171417230,90610668,249467503,736959541,140578381,118028533,3075547136,51043051,108799351,953466007,3060598691,2568939703,3313768341,164123006,3315249819,3315161343,101908457,310428363,143978161,3188771188,103360222,62440334,3305040574,717823472,2165547918,3309214744,194818140,3027625673,60488438,2817895163,1385882678,3234542166,1377990398,2471102148,957554653,72193432,108356264,74138745,119721132,277539115,543550938,3234009691,1416515155,65754940,307616123,3223891651,202475466,182215226,109172989,547415922,759904172,3178165234,158968928,1704656654,2947500077,540325825,144017404,58707486,174340046,178176985,96226410,2446326906,3291526233,2391827636,91118693,46665961,49800383,2554405965,3302399297,1445479231,2205593438,173148971,2393122939,2797014525,1546569181,3300873034,162938189,22396660,87354841,346275008,349277238,40057480,386049490,208215778,195067625,133440439,506746245,1938244904,769971398,137802058,171566015,28396933,83720149,188179463,884662543,3146261998,2523783757,393916468,165124072,91977525,486844154,2949064138,2512586616,3290054627,1241955937,2370689047,193434411,246498013,142882957,216928150,80146161,564423395,2346778004,362703436,121516028,1374693740,705176716,339106680,339933133,122731611,2555200491,484519537,630310143,1628825911,2536787323,123666681,123991801,51927108,66856617,138883461,1928228234,346891989,469497308,72870760,148192361,3198049972,2836152387,52445422,120928088,186703050,76851496,108656237,76323258,962642184,3123580125,239501917,572556011,154379666,3020169677,195848637,249291717,137430383,2969097526,1551569766,1908351914,314360953,2359834430,2176602181,339318410,2838351214,2844363248,296031099,2493822681,2851065318,2810414693,2808922629,2813433163,264594301,143803230,277658945,2752974741,142281974,701901444,131878379,132000290,2751158968,606681716,2584782840,83673552,115452805,2252535961,153905690,2734999339,2689612994,2719311368,2713070227,2294709204,105916092,159167223,252252168,293286716,585599054,2617758688,1596455522,82089415,154388680,417800701,76261866,384099234,2543164175,247344582,564053744,119812027,2559887606,749961218,398886839,186632981,2554056459,2613015351,78778887,2361453635,188175672,2562489416,278618966,169991299,138884586,155603513,540935733,1514987461,138789398,2548260314,1656122978,234732008,257448144,1694845266,813753314,346052201,69512416,272201152,2548966415,100527939,48917813,1337775006,330210471,425486049,158557841,64088973,138164692,187283858,2564033662,2527569626,114328122,123872731,126421359,91724174,155664009,68458443,1701701173,195357299,143573385,2432008290,1636466527,87556849,347599264,108428667,824432924,110705199,533368733,275509738,2459963778,2350180459,348466992,403657201,62311358,143659243,72308106,292680693,77328162,1280402498,2439551330,606966310,131167453,2434930116,2319896010,336062146,504995033,92901030,277069716,54250996,103340583,2168420357,1682522029,76154253,2376245678,2417819876,2163174073,422161780,1905089678,92569561,308570382,230541693,2429833503,1405554524,2402082210,297709108,149597209,1454638494,2406850679,2384046644,335049893,410831528,75081890,1083499874,235179654,369535511,74645646,99812915,1795002025,197161871,115139958,305360685,137430904,266116374,1514677686,346740935,594705026,69112530,331688697,872068256,2211057732,281132168,141661541,116882157,44390131,2377534116,37543859,453481855,343679065,91107632,194208299,143406152,91722899,387100827,97252471,135922015,108459495,462111860,1368505884,389120387,270369362,380981915,114013948,80445610,120873942,381022092,112867903,115559888,68265080,1408556942,2358283734,1832522725,2361637527,528953365,207650390,714666264,140135955,117491799,562491033,137802752,63806813,123130767,72327070,197123594,282077884,72318544,107573587,394478006,211264698,108802961,122786669,144383762,1431064393,488886179,224285958,66445635,1648467847,92430786,327944955,94673672,85312305,1229236062,1504422163,2177473012,1898500981,147367585,526713687,113104089,2150906438,163488173,238663099,121435546,102483203,1904873642,1935019375,551420543,155036466,709939469,1947060072,94341133,1932119995,163206460,1945391156,50425796,1042114656,408269961,1925690455,1089727452,266620049,110588604,78199042,138269674,72094580,88554422,904555994,1938045475,1255548157,1928016098,1879590655,45694670,1167345930,1339559040,145474003,1879732364,556918893,104384415,75537430,120974338,201007361,1252741500,441983794,197065463,1849174291,49658852,118891483,319187216,1679295138,134327356,1431861128,406522226,1694283240,139738818,42875348,118809014,306822508,1361982978,170926132,213105568,541888471,1130601146,1074822697,327674186,814243016,423847933,184593329,157532238,11162772';
//        $ids = '21197643';
//        $explode = explode(',', $ids);
        $list = [20120979, 182178820, 300998539, 1270726773869735936, 1344005187820793863, 1354068595857371142, 139181676, 1088585923321831424, 2924774078, 902153622129074177, 790624550, 337898180, 1018595949403238400, 1267866658586136577, 1287119855490084864, 4744353975, 3257561214, 1064538237442682885, 1280177793855221760, 1107844805252403200, 324793123, 210942925, 836237326187560960, 1176898886465740800, 703964080, 14090977, 3088620118, 1250320423817900032, 1286442867846717441, 941675887, 16611896, 30782917, 1218342933327278080, 67227724, 1344776879782375424, 3402218583, 728529685806616577, 1188125517226168321, 1337071416567586816, 1193543090944053248, 144858839, 2436642930, 1234643724694540288, 1052264902776082433, 135488533, 1345188134426791939, 26180917, 1294664238250602496, 761465617975083008, 28064000, 977711509953421312, 52531104, 1229371581899694081, 968829319240933376, 1187697934336483328, 107202491, 1283536401309380608, 32548474, 1590504140, 14307692, 1330909046199771136, 1344131547411189760, 1344352758456057860, 1340316084575096835, 147672166, 2726658152, 1332983994657476611, 779901685644730368, 773117689891987457, 1730897000, 1104356586791813121, 1055251634845040640, 2194394673, 824659956322500609, 23169735, 1323647985675325440, 1340779131773063169, 757696891, 339831556, 2555015184, 833031314773331970, 424826350, 738880159261024256, 1300859141645152256, 486950038, 29820543, 1327171671531401216, 708418481, 1267929336113295361, 612062112, 352084835, 363633544, 1003470243224641538, 547693795, 3058742765, 737760492337258496, 83963204, 1336329914375495699, 2599988148, 1313248334832963590, 18989239, 1020405030791319552, 1321239498844418052, 339905769, 65563900, 813868075556761600, 1279331656671932417, 880698463, 118101141, 15689936, 14297863, 853318910971662337, 171973084, 36978670, 1145639455048572928, 838771732408229889, 75742264, 536487388, 32630870, 822468075618439168, 20847735, 14614500, 2863295953, 262890194, 785646553423687680, 1052523159537233920, 552802776, 1326938642393272321, 1297202300079845376, 87445520, 16034110, 273689112, 247164424, 956876047055810561, 1287836066666418178, 943282670435520513, 1645127726, 1155864992740270080, 1315729296669974529, 740600552, 1309536651706761216, 38387719, 468398903, 831981042395406338, 1232304279270109184, 796461123738497026, 1001115730086105088, 104751678, 1317737516116570113, 26577568, 1303744551627165698, 828006789199327235, 731166234864144384, 60116024, 1322246176641568768, 16463348, 881712699616370688, 1283580838018506760, 872293773195325441, 798041400394727424, 859860396383113216, 1137089689, 296727260, 2312197657, 46784333, 1175236418827739136, 3293534113, 2328052837, 1153663651242364928, 1320996886480912385, 228144288, 732288594501500928, 1158739948926726144, 933345397317292033, 1202511744360337409, 948749690, 1321030141397684224, 3234879118, 1159518586911842304, 117259233, 138643837, 311877543, 24733117, 434599394, 1116752452752150529, 1232333068742144000, 4668528318, 4361461101, 908173614381506560, 1102273333129814018, 746445728587755520, 3748475247, 1085597192155467776, 1313886733931511808, 30530776, 900865553425944581, 14101371, 20852175, 796770404148899840, 1033751995184762880, 215289433, 1252217110379593729, 245141819, 810818800627175425, 17490707, 2614008657, 1137694900093444096, 2421193216, 89112050, 330684439, 25781702, 109685860, 257910024, 2266541233, 28354074, 1035540356903956480, 971214978119290881, 106505571, 1274721342621839360, 44538160, 898866801064411136, 2763625010, 726054154607726592, 341714417, 47336979, 1129056087758581761, 954705594161643520, 46161431, 881105019667447808, 1312158748421562370, 211135906, 1055213228278628352, 1418487294, 6455232, 1027590708927057920, 739780071762825216, 817583913975435265, 16582329, 298299421, 953173482833170433, 1260011002239897601, 128429068, 39643733, 698919881547366400, 25610343, 824281921714851840, 1249782935147823104, 3154234193, 1017068980551512069, 2550176466, 361902109, 26799789, 259621868, 1400113566, 718003371639066625, 758050879354175488, 1306249114645073922, 1282110773490339847, 1299589027046121473, 1542372750, 851477335052140544, 1294136038781149184, 769216514037846016, 4218124714, 1024400459295940608, 1053314934040420352, 1023045913994919936, 811661444, 810726799256809473, 1267202106827526145, 1210504597141217280, 1283895519522312200, 1302741343949803520, 1232456629842374656, 956955048185131008, 1302690275681214466, 1272850773471354882, 213871548, 334733041, 1008534511540424704, 760332659360956416, 1235979238957858817, 2340693422, 1173646188, 3039534033, 168478460, 1381029961, 308868833, 273048699, 1242424221529186304, 848447701570244613, 1264067029440647168, 3297160441, 79600466, 4322383513, 3427261, 14494808, 873754787069689858, 37047399, 1299715016271294467, 2757110691, 200690782, 18817914, 1057081886, 832045790289858561, 748186936787951621, 3164684622, 2179348804, 840827187792117760, 1293510025680478208, 1253715317311696896, 374667569, 728270240321253376, 758386615748263936, 36413716, 3418339671, 314024592, 801442012075528192, 1284401161290776577, 908081632736813056, 327643012, 329241720, 2270947182, 836669116958322690, 1280252631550738432, 2866141196, 2558611388, 297261364, 1010508853782298624, 17658640, 825838514201776128, 798544616, 2303965747, 926854748, 1266991411125092352, 825783812227489794, 550482343, 2986415328, 1005557387376279552, 984524507640672258, 2374578403, 39370646, 1293292036792229893, 957217998842073088, 876922710592438272, 7131262, 1150363994135265280, 38516789, 1281312250662457345, 1256309812993896448, 932355118271467520, 1300344370978336768, 20654307, 314066587, 2282979822, 714210514327330816, 829647490270056448, 1214502139, 902785071580463104, 49441273, 1286835648947728386, 730048623921127424, 266685178, 1045412334687014912, 1290069660914847744, 1279561556506939392, 1312929638, 513578327, 1102480935327551488, 23536486, 1142463598503051267, 1275862027475419137, 1724172546, 1291238118226526209, 1299311652974800899, 1256342623612276737, 60666105, 1047991073447006208, 15063127, 747866820, 1171313979500695552, 358146696, 932051893, 1116761627309879296, 1204286713624956928, 92720521, 1298995373483028484, 1094366471713640448, 2900680749, 1050876360892264449, 410429674, 170873674, 18404810, 779333699108278272, 368974008, 803572371554729984, 1367043446, 1037332683972648960, 1230663883414757376, 764569873, 291406372, 1172493527567216640, 1126372766914101248, 1867596428, 18650281, 1276429164, 1153315649902563328, 847253499301609473, 827158722170454018, 752221293181825025, 134790044, 851957238419902464, 755612712994877440, 741046814334451712, 1281739134537736192, 17123502, 63491295, 21130829, 30007216, 3027434098, 929120344878678016, 48702842, 98713687, 15496178, 25375392, 16618484, 4653373394, 4937061, 833758283500441600, 24926933, 3227278405, 1131641514046525440, 11542422, 384533439, 3088797855, 4615361653, 1231357003890446336, 2517035006, 16689426, 1546590872, 2297534144, 1571680507, 2287376294, 419912338, 19556530, 2187906247, 282772328, 130326816, 469919231, 1118427588, 1961733895, 1225004851593125888, 6549332, 2992364946, 580016078, 32843975, 1222278238992338944, 174860181, 847933551521681409, 1197358506929733638, 1548814340, 755549467584061440, 1240924328256045056, 830932318684585990, 21005278, 49511011, 101425338, 951753767183093760, 837169613527928832, 128763579, 1244997275694202880, 995379264026394624, 1054131570221764608, 138869971, 822591807821381635, 1573827930, 1252603384764530688, 224393497, 1265326545607917568, 1210199876, 429718314, 493775634, 1166902965099089920, 1279217757385621504, 1219629047568834562, 1145973238431748101, 1285247697868533772, 1451686290, 314723101, 45094451, 1292232093255303171, 1073663034260889600, 405841587, 3237195795, 719948829773185024, 763863970579116032, 1197949795962363905, 543312687, 830331048223469568, 2184934963, 1174330971958775808, 252772954, 810747356, 291228180, 322180487, 781209744715513856, 904408999, 37826188, 258125653, 1072278248770412546, 3082546368, 1103555483334520833, 3305654490, 1261789977022803968, 15301029, 1226370152440225794, 478375682, 3438250311, 1291011918086516739, 2598999181, 24435182, 926309671773683712, 14555901, 820402138174148608, 763046935947190272, 1600745701, 614905721, 33602297, 1279613272879034368, 759201072397357056, 354478320, 251705823, 149669540, 436886807, 2973783453, 1218212189997293569, 247048347, 1237145131838509056, 15485307, 34354747, 825776310790266883, 919427304241139712, 2290195934, 219200570, 1194152189142417408, 1277275248400969731, 933788114, 39194722, 1062062708542107648, 1255456723931971586, 1057021559896981504, 1537644018, 1053042002063962112, 1535246833, 247288671, 1270155546499268608, 15993745, 2387366408, 942826806192861185, 964277934692470784, 1173019366129987584, 787741529020309504, 1151110154936623107, 871363741404803072, 710549634582581248, 1262111604117835776, 1204062952246128642, 401717152, 2375714753, 1181610649949892609, 15985012, 74489944, 36588590, 13539242, 1278344526881599489, 1160317958184325120, 2732521696, 1178309200088326145, 847930237, 824644620013408256, 617767191, 1023352786514321408, 1267848021666127874, 1267781264230117381, 1720306344, 393211622, 1122337995594653696, 4581206240, 1223397450, 1934967121, 2896151700, 1170804052994641920, 38704097, 1684990992, 206508957, 1206202757599903744, 250110840, 199305480, 702628629814124545, 1288886019325034498, 2874704232, 23017454, 519872763, 1088812005417512963, 2805276832, 19081489, 978519631, 783765851325534208, 855855671895408640, 834163885913542656, 1279960090238312450, 3281863351, 1280615697077415939, 2186543572, 495128586, 786321277732605952, 1255570988391071745, 907954900306337792, 1265358791664701441, 32571980, 1666361832, 728045880260100097, 41223508, 2842136801, 1230944350911246336, 24304716, 3086889841, 1287147365183270912, 927693418712662018, 1281203447644200962, 797203210385690624, 3138381354, 3323615550, 1278518241539710976, 506521421, 3793325854, 22407785, 1130513850351181824, 936757240668680192, 1263418879344177152, 1242903663447851013, 493526610, 20458261, 1283480240514367492, 949363605773807616, 1010133378, 2942723811, 1100132960538411008, 2724788592, 278661432, 1207866600579387393, 1356914688, 34383891, 1851931958, 14219928, 66693790, 1164009361984958466, 818161854, 1167290248918753281, 1279216181166178305, 708097949822156800, 1073138918797631488, 1180586328225910784, 21270917, 755080409055133696, 1126986194607325184, 757077309757227008, 745342890889486337, 43878904, 820187383, 15928172, 373111430, 799439293378859008, 2272640742, 3006922331, 873636815630106632, 931391704892092416, 4009999396, 1182774776638476288, 802874227753881600, 3004295129, 969793948934815746, 204956272, 4261792354, 2305740539, 1081117514, 911280399032229888, 1165280597855625217, 45932628, 1099012274428231680, 999346829211906050, 192279913, 738654903409778688, 983162306862485505, 636493714, 1013294706405457921, 1199482505763655680, 1259076419747020801, 43153641, 9093, 1082454967594582017, 288533666, 927865967367131136, 1276287714405396481, 767, 1178423913757450253, 286166830, 971325093224820736, 520654702, 17717593, 18110932, 1207301431335825408, 926861000720240640, 73537202, 135922295, 790339741, 1237215015523868672, 1365261642, 404982607, 1076508048666054656, 3900559094, 3038546955, 2357945024, 280166523, 57060169, 17171578, 129494205, 469721484, 12162082, 3297292521, 3315909714, 1038424481356754945, 835959067738783746, 521926147, 209924428, 51242560, 2409269164, 909500465922154497, 898762021, 86712827, 366257725, 1174914819985510402, 103183975, 18933832, 12841122, 1111994538426544133, 1101465997683445761, 799819390279483392, 916036448, 35887555, 959252368662687744, 26642189, 16801580, 241581504, 22042041, 876240395470069760, 2995204103, 1116194332615143425, 53767041, 488063980, 344291737, 2282752621, 1087909454279045120, 1198125010734452736, 1248623879481774080, 15493092, 836212833067094017, 1223044984766525440, 267897125, 903316311517921280, 958399612859031552, 1195393189, 476446752, 2945860411, 962356391678828544, 19841204, 332792979, 1045601544148844545, 253721710, 706134825653006336, 808890451554160640, 20383925, 2866203939, 3435192275, 4737234521, 913417298240786434, 702125877, 326665662, 250899240, 216347182, 1253367277732454400, 805903618842959872, 20518171, 1226522490299506688, 525005120, 63000927, 1248005395400011777, 150718386, 27285593, 1074193698970370048, 21421483, 883529255853867008, 1198689670055333888, 1216070266498973700, 56886141, 1952275405, 553513918, 23841816, 1147630879214395392, 14235323, 887152821321297922, 157712830, 17544252, 42652557, 1903560060, 159741317, 85193539, 2670949502, 1241224446, 3722321420, 1244303576324812800, 604890566, 879161563, 797075134083371008, 24590078, 4518610392, 1189437663402577920, 779766160774443009, 441700734, 38722553, 1924946232, 77211409, 2726718480, 28140059, 864610968, 887665628823265280, 826295954835910656, 1109981646, 386133306, 3236063660, 979121746698674176, 869529486529675266, 3141317233, 929064818, 1238678899359232002, 1224790022303309824, 2369829510, 844498909, 35546942, 2206818593, 4450080978, 1213517890764193792, 2997798614, 1049951682782797824, 586181085, 713107684581588994, 825829081866436608, 983766703871090688, 181061991, 249739297, 34530995, 228106543, 760534794258132992, 34907435, 331336793, 1074105829605998598, 1231410902051717120, 16289497, 324127755, 15553980, 1001905424541478912, 954257879317602304, 1045311759660257280, 825545613471256577, 345141523, 20806807, 181776627, 994440743283449858, 918548885018218496, 2939942884, 830251268312403969, 719666283336318976, 28023025, 1218315227298553856, 973967528543293442, 17179015, 1191534548699336704, 1176185298344120321, 1232764157931511811, 3949435217, 1232436038213275648, 1231823145243496448, 1455506612, 1232220451004350464, 1231566961571594241, 186001260, 1231300160963174413, 1175658008975564800, 3208777187, 17243368, 583196481, 3327420822, 1196014254324891648, 284555960, 34998509, 1120358913772154881, 1201585244870074368, 1208865454476808192, 1085760617208635392, 59386332, 2532013618, 873605556, 87629909, 3328884245, 1186323720597573633, 1157977785702518785, 2877018681, 934081207171629057, 1113673391775420418, 805191985388814336, 2854547449, 948806472531505152, 81333564, 1197089350430932992, 22738664, 1215867424123183104, 1110930569989365760, 1142797681, 3108813626, 2928867656, 22529194, 3149760253, 254820047, 56783739, 1018298427782848512, 3013003843, 24102760, 2394109711, 1106971049223176193, 898880517394898944, 861321521884737541, 1090651566955057153, 1400553392, 52144414, 497426941, 129654512, 145464608, 195023592, 1199324394692251649, 18785984, 1204310729211490304, 1158512459797401602, 24362589, 485086985, 364462906, 61437586, 1172884329346871297, 1078877868761899009, 70753992, 3938173949, 304163654, 1122766840000737280, 16945095, 38241210, 825160690914689026, 869666172551278598, 155944479, 1202906479407312897, 831040250, 1118116957394472965, 880831163887218688, 129810881, 3965827584, 65466158, 1264882592, 38417649, 368515179, 826289589597982721, 325202168, 1183964060116799488, 306365828, 56834051, 259279837, 17331288, 1032460362728304640, 1194077193963356160, 197978371, 891273653404524544, 1105012994, 1172665754929508352, 2870953361, 51111863, 16341691, 956393404199444481, 2542162244, 858942061067632640, 1186148277621624832, 921142618452570112, 781240790727036928, 191174455, 252161971, 991823125149925377, 49483255, 1007056815086100480, 248936933, 1304343799, 910214868183191553, 2305950187, 869808943, 1198310356898189312, 275619201, 1138089379, 3364631793, 94845804, 17824687, 1194263408327233537, 282396403, 47397924, 17010790, 212445456, 3797988864, 278564308, 739186835235147777, 1194285021097418752, 2523369962, 3434603805, 1140512938136166402, 803595420, 1346234622, 1192447978742669312, 423661243, 4426064834, 1187410424154730496, 190192052, 1055660086243287040, 4434818952, 17699784, 273449983, 294037479, 1172729166212587520, 1367248214, 1049426568857174017, 1103397110697754624, 235855440, 770760054, 704473408570916864, 831015640282628096, 1160621913640722433, 740865739255603200, 408100996, 1184254969165291526, 1085844992231464960, 14577610, 76976448, 383806395, 131900036, 15829599, 1157117103708749824, 46668906, 2251345945, 1056058599753973766, 2930400593, 4334071758, 101046533, 318632353, 227198039, 910767907377889281, 1185237802386153472, 3406065993, 847356160386650112, 496402370, 924763525628747779, 15562898, 2941163216, 962449567, 497743215, 1132022379356610564, 1146645476806205441, 1131230740249600001, 315359604, 214743296, 1124060711343337477, 828020373002256385, 1170996621099831296, 133423934, 1167785340490473472, 35646486, 2799271977, 39186652, 113520268, 230647938, 860412132109697025, 134842779, 856649504916996096, 1087682381761441792, 1114659798950268933, 1905029168, 14466732, 3059801947, 90666795, 1168535053204410368, 1165793846111952898, 804957271516016640, 1131254186824196096, 790153368664698880, 21836409, 76083417, 243931938, 1955107099, 340563829, 2203392391, 3370252143, 551497094, 210301294, 3153460440, 130787908, 628434005, 35692915, 821187814523998209, 47304684, 1379028470, 22231854, 503226991, 17586118, 887276492, 913429095861559296, 1017883562450849794, 1142593096699600898, 1696629974, 1149805624772964353, 1148158229383450624, 2323119010, 1006227385467973633, 18021726, 757681634825031680, 63232271, 37516921, 1057910066, 4305638712, 489975747, 1046525435390185472, 190508857, 1018837763918127105, 5449422, 24731568, 3114422673, 823492152378454016, 1141087749560127488, 955108533871267841, 834148014, 1091321463758614528, 1085124914347237376, 218379543, 553012178, 1137622684521717761, 826101886390525952, 3051132120, 15497928, 18004475, 11601582, 594836462, 1122356675703263232, 742414550650195968, 756870420528259073, 1126757336645656576, 956250134786002944, 1110314623876501504, 487133606, 287334546, 928691569, 1044296977859538944, 479188249, 53503202, 1119395808326103046, 48011046, 16799997, 763436259595345920, 784699590025019392, 711227929494216704, 1126633568367730688, 1128780678059966464, 1109216662127935488, 1126362592329510912, 1062759130471981056, 119166713, 827065434306252800, 46690823, 779341926453563393, 1061311531, 1059596811340414977, 3009720301, 911407729553530880, 1123614232589639680, 191612136, 3997097278, 1074177396897734656, 460487406, 2740283856, 1059870256888455177, 2724617761, 1152665659, 38956896, 1073560832380993538, 2485308468, 151582239, 1112222605195599872, 1025047621512118272, 2706872107, 108286674, 1067909450122567680, 570266167, 912842592802476032, 16333660, 224298143, 2491653979, 6635452, 95263650, 1004822515, 2341053625, 140489203, 1113134845172047873, 3161370883, 842254805649219584, 1114446530323333121, 17786914, 16185550, 546543567, 2519501323, 59810344, 1109275824715370496, 896265835, 58754490, 2600092572, 1011338731, 276133159, 1069223383416619008, 820000511403249664, 804793303, 202385534, 51857045, 5747822, 3118810453, 108381581, 45891623, 764143993923907584, 68173734, 119758837, 827362606700707844, 2979207160, 120439298, 1067120096190046208, 23810260, 74216940, 9897342, 1102874369871831041, 1054783235639652352, 894057794, 1089641012325175300, 3421301013, 971401324985307138, 1661493066, 964602063668703232, 35411013, 1103036272573067264, 1100052566736461825, 861946035668701185, 52773352, 119800419, 3025052073, 1052301513375150080, 425179615, 14208187, 18111180, 1014930101132234757, 1688, 6858242, 488018465, 2514539338, 6150422, 219735295, 367735444, 878496641178673153, 4379851994, 1051649666717294592, 1328603510, 804035561392521216, 1358142446, 249880957, 386304404, 104914298, 1084782270140084224, 1090340251179073538, 41410432, 2549376954, 1012084307421212672, 1042265500108156929, 1019369722863915008, 81305054, 2179078237, 3365, 2180243592, 4895297909, 84704680, 512661784, 291831562, 866102366, 220605577, 784030662953140224, 996790477902008322, 574518803, 808142928958910464, 20582624, 2851542947, 1080979950457491457, 2480936977, 872545974513655808, 100487640, 14993272, 594688914, 1073457325963235328, 2306228096, 60807261, 575429484, 576319628, 1066772694224519168, 37726772, 1653450847, 3744439153, 486662301, 753849721140109312, 20761579, 1079730404322623489, 1002099476, 330077090, 509185272, 18335844, 841287875329175552, 936280491778392064, 1605693206, 288661791, 987105330537553920, 431996746, 1507061370, 703060885435244544, 172854735, 1071171784278306816, 2307675307, 861771558355906560, 833224452787761152, 742724669028114432, 228999839, 301382300, 33401304, 2507144761, 27521272, 940767156924485632, 17376429, 1010185160929828870, 18299857, 845796489939050497, 2201394067, 201559182, 1012174076847112192, 834224215108775936, 759761679613698048, 824024200121753600, 2585845003, 2750105810, 83694690, 27694418, 894318375488241665, 538374325, 1023054737036460032, 1039521776273944577, 844693579784163328, 2364657150, 16194898, 780059731595448320, 1059118316034215936, 23492297, 278741423, 531542242, 3391816359, 1045229135889682432, 1057344966333218821, 426020316, 2176211192, 21398055, 793619213399252996, 1049686762337914880, 1047459656640204800, 956013326185746432, 62932762, 985293990244237312, 423107879, 1012108600209051648, 794198, 1044654274079186944, 7010872, 1050603452483522561, 841282843, 322207370, 15927758, 834987255873867777, 283833538, 707664146423123968, 842083845209903104, 875794060216336384, 500217926, 1494895243, 901982165902163970, 729935241758932992, 1534114230, 911729436, 19089077, 32901105, 36091500, 41868331, 15936867, 494350699, 267388683, 19146710, 943442177203597313, 826575352021479424, 18758751, 3937914677, 13795732, 6742522, 3230328938, 707553683723128832, 14645160, 983464688745775105, 990913133551149056, 894949683206004736, 808402694742413312, 7807012, 15693746, 956482165, 180858105, 16132035, 2339525124, 1915533469, 5402142, 900831599822073857, 829913424150818816, 2551055478, 123351802, 961855655773593602, 2473212348, 565748639, 409371254, 900557854284800001, 27651810, 16074627, 1646629716, 200718285, 30035205, 480843442, 28764959, 951863219773104128, 27402782, 926546483746344960, 891751306527858688, 500705741, 4114049080, 275221499, 388273208, 792251114, 24087992, 25458378, 917614124686753792, 23181999, 776399935, 771272095879823360, 217506104, 874703718121451520, 3242795869, 1183853520, 793805385991880704, 18539631, 730188024911429633, 71074656, 841449858317733888, 829599015616516097, 832340841981112320, 195403144, 415298013, 2754243824, 809625465715499008, 773790602282541056, 796406505687785472, 1413425293, 3226778767, 90329133, 2812582934, 3236901202, 77370008, 2415586555, 22142259, 357235278, 42473303, 38633776];
        foreach ($list as $row) {
//            $index = array_search($explode, $row);
//            unset($index);
//            $newArray = $explode;
//
//            $arrayUsers = json_decode($newArray);
//            $string = implode(",", $arrayUsers);


//                $fields = [
//                    'ids_followers' => $string,
//                    'user_twitter_id' => $row,
//                    'user_id'=>$rowUsers['user_id']
//                ];
//
//                $this->User_twitter_model->save($fields);
            $this->saveUserById($row);
        }
//        }

    }

    public function miningListFollower()
    {
        $twitter = $this->apiTwitter;

//        $all = $this->User_twitter_model->getWhere(NULL, "array");
//
//
//        foreach ($all as $rowUsers) {
//            $explode = explode(',', $rowUsers['ids_followers']);
        $explode = explode(',', '21197643');
        foreach ($explode as $row) {

            $userIdFrom = $row;

            $getfield = "?user_id=$userIdFrom";
            $listFollowers = $twitter->setGetfield($getfield)->buildOauth($this->urlSeguidores, 'GET')->performRequest();

            $arrayUsers = json_decode($listFollowers);
            $string = implode(",", $arrayUsers->ids);


            $fields = [
                'ids_followers' => $string,
                'user_twitter_id' => $userIdFrom
            ];
            if (strlen($string) > 0) {
                $this->User_twitter_model->save($fields);
            }
//            }
//            $this->User_twitter_model->save(['mined' => 't', 'user_id' => $rowUsers['user_id']]);
        }
    }

    public function getUserByGeoCode($tag)
    {
//        http://search.twitter.com/search.json?geocode=37.781157,-122.398720,1mi
        $url = 'https://api.twitter.com/1.1/search/tweets.json';
        $requestMethod = 'GET';


//        if(!$lat || !$long){
//            $angle = deg2rad(mt_rand(0, 359));
//            $pointRadius = mt_rand(0, 50);
//            $point = array(
//                'x' => sin($angle) * $pointRadius,
//                'y' => cos($angle) * $pointRadius
//            );
//            $lat = $point['x'];
//            $long = $point['y'];
//        }
//        &count=100
//        $getfield = "?q=test&geocode=$lat,$long,1mi";
        $getfield = "?q=$tag";
        $twitter = $this->apiTwitter;
        $response = $twitter->setGetfield($getfield)
            ->buildOauth($url, $requestMethod)
            ->performRequest();

        return json_decode($response);
    }

    public function getPhotosByUserName($userName)
    {
        $url = 'https://api.twitter.com/1.1/search/tweets.json';
        $url = 'https://upload.twitter.com/1.1/media/upload.json?command=STATUS&media_id=710511363345354753';
        $requestMethod = 'GET';
        $getfield = "?q=$userName";
        $twitter = $this->apiTwitter;
        $response = $twitter->setGetfield($getfield)
            ->buildOauth($url, $requestMethod)
            ->performRequest();

        return json_decode($response);
    }

}
